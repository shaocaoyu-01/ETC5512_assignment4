---
title: "Assignment4"
output: html_document
date: "2025-06-06"
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Divergence or Convergence? Unpacking China’s Provincial Growth Trajectories

Prepared by Caoyu_Shao (Monash-ID:35323876)

Assignment_4 ETC5512

Due date: 2025-06-20

<!-- ---------------------------------------------------------------------- -->

<!-- Data Details -->

<!-- ---------------------------------------------------------------------- -->

## Data Details


#### Topic of this work


Since the reform and opening up, China's economic development has been
changing with each passing day,however, the imbalance of economic
development has always troubled China. This report will study the
relationship between the total economic volume and growth rate of each
province (autonomous region, municipality) since 1993, whether there is
a Matthew effect or an equilibrium situation. Furthermore, we will
explore whether there are different evolution laws in different regions
and different stages.


#### Data Description

The data is a panel data of nearly 34 years from 1990 to 2024, which
includes GDP, GDP per capita, growth rate of GDP per capita, that's because we
think to research the imbalance of development between provinces in China 
mainland and its trends, it's very helpful to conclude the relationship 
between the growth rate of GDP and its volumns.

And GDP has relationship with many variables, many scholars have researched 
about relationship between the growth rate and variables like industrial 
structure, growth rate of fixed asset of investment, urbanization rate, education 
level per capita, degree of opening up to the outside world, scientific and 
technological location.We use the above mentioned variables as control variables in 
this report.

According to Solar Jin(2025), the industrial structure has a significant 
relationship with the growth rate of GDP per capita. He use the ratio of the added 
value of the tertiary industry to the added value of the secondary industry
to measure the deep transformation of industrial structure. He defined it Industrial 
Upgrade Index.In this article, I will use this indicator as an indicator to measure 
our industrial structure

The fixed asset investment growth rate measures the annual percentage change 
in gross fixed capital formation, capturing how much new spending on long-lived 
physical assets. According to Wenyue Li, Jungang Li(2022), the growth rate of fixed 
asset of investment has significantly contributed to the growth of the GDP_per_capita.

The degree of opening up is an indicator referring to how extensively an economy 
engages with the global market through trade, investment, and regulatory integration. 
According to Huiguo Zhang(2017), they concluded that the degree of opening up has 
positive relationship with growth of GDP_per_capita. 

Urbanization rate means that the proportion of the residents who live in urban
areas rather than rural areas. It matters because the residents who live in the
urban areas usually created more GDP in average. 
According to Canjiang Song(2018), they found that the elasticity of urbanization
rate to per capita GDP growth is about 0.15.

The investment on education and the level of R&D funds usually indicate the indensity of human capital. 
More investment in Education , more indensity in human capital and the huamn 
capital is crucial to GDP, commonly speaking, well-educated guys create more GDP.
According to Danjiao Zhan(2021), she found the investment on education has 
contributed to the GDP growth and did a quantitative analysis.According to
Dandan Su, she researched the R&D funds have positive relationship 
with GDP Growth rate.

**Datasets：**


1.  **China's province-by-province permanent population data
    (1993-2023):**
    
    - source: Chinese National Bureau of
      Statistics(<https://data.stats.gov.cn/adv.htm?cn=C01>)
    - content: It includes the population data in every province in
      China mainland from 1993 to 2023
    - recent updated:
    - data form:CSV
    - restrictions: It includes the number of residents in every
      province, but there are still some value not available.For example, the
      number of residents before 2000 are not available.
    - ethics and privacies

   

2.  **China's GDP level by province(1993-2023):**

    - source: Chinese National Bureau of
      Statistics(<https://data.stats.gov.cn/adv.htm?cn=C01>)
    - content: It includes the GDP of 31 provinces in China mainland
      from 1993 to 2023
    - recent updated:
    - data form:
    - restriction: It includes the GDP of all the provinces without
      the population so the GDP per capita is not straight forward.
    - ethics and privacies:
    
    
  

3.  **China's industrial structure by province:**
    
    - source: Chinese National Bureau of
      Statistics(<https://data.stats.gov.cn/adv.htm?cn=C01>)
    - content: It includes the ratio of the added value of the tertiary
      industry to the added value of the secondary industry
      to measure the deep transformation of industrial structure.
    - recent update
    - data form
    - restrictions
    - privacy and ethic risks
    

4.  **Fixed asset investment growth rate by province(2018-2023):**

    - source: Chinese National Bureau of 
      Statistics(<https://data.stats.gov.cn/adv.htm?cn=C01>)
    - content:It includes the data of the growing rate of fixed asset from 2018
      to 2023. 
    - recent update
    - data form:.csv
    - restrictions: There is only the data from 2018 to 2023, so it is not 
      comprehensive. 
    - privacy and ethic risks
    
    
5.  **Urbanization rate by province(2005-2023):**

    - source: Chinese Statistical Yearbook
    - content: It includes the proportion of urban populations from 2005 to 2023
    - recent update
    - data form:.csv
    - restrictions: The time range of the data is from 2005, not comprehensive.
    - privacy and ethic risks

6.  **Human capital level by province:**

    - source: Ministry of Education
    - content:It contains the education investment by regions
    - recent update
    - data form:.xls
    - restrictions: it contains the education investment from 2001.
    - release date:2024-12-19
    - privacy and ethic risks

7.  **Degree of openness by province:**

    - source:Chinese Statistical Yearbook
    - content: It is not very easy to weigh the degree of openness by provinvce.
      Then we come up that we could use the volumn of imports and exports of the
      province. So we use the total volumn of the exports and imports to 
      indicate the degree of openness by province.
    - recent update
    - data form:.xls
    - restrictions:The data is extracted from the Chinese Statistical Yearbook
    - privacy and ethic risks
    


8.  **GIS map by province**

         
    -  source:GADM（Global Administrative Areas）(https://gadm.org/download_country_v3.html)，download the china's resource
    -  content
    -  recent updates
    -  data form: .geojson
    -  restrictions:
    -  privacy and ethics risks


9.  **Division of economic zones in each province:** 

    - source: Chinese National Bureau of Statistics
(<https://www.stats.gov.cn/zt_18555/zthd/lhfw/2021/rdwt/202302/t20230214_1903926.html>) 
    
    - content: China was divided into four zones according to the Chinese Statistical
      yearbook 
    - recent update
    - data form:csv
    - restrictions: The information is extracted from the html and edited manually.
    - privacy and ethics risks

#### Data download

The following section describes how the data can be downloaded from its
original sources and what initial data wrangling steps have been taken.

```{r}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      eval = FALSE)
                
library(tidyverse)
library(here)
library(sf)
library(patchwork)
library(readr)
library(rvest)
library(stringr)
library(dplyr)
library(tidyr)
library(readxl)
library(tibble)
library(ggpmisc)
library(ggplot2)
library(viridis)
library(gganimate)
library(car)
library(olsrr)
library(broom)
library(plm)
library(lmtest)   
library(sandwich) 
```

**Downloading Dataset 1**

```{r}
#pull data 
# url = "https://data.stats.gov.cn/english/easyquery.htm?cn=E0103"
# this data is about the number of residents in every province
annual_residents <- read.csv(
  file = "data/Annual_residents.csv",
  header = TRUE,
  stringsAsFactors = FALSE,
  skip = 3
)
annual_residents <- head(annual_residents,-1)
panel_residents <- annual_residents |>
  pivot_longer(
    cols = -Region,
    names_to = "Year",
    values_to = "Residents"
  )


clean_year <- 
  function(df, year_col = "Year") {
  df |>     #extract the number of year
    mutate(
      Year = parse_number(.data[[year_col]])
    )
}


```

**Downloading Dataset 2**

```{r}
#pull data 
url = "https://data.stats.gov.cn/english/easyquery.htm?cn=E0103"
# this data is about the GDP of each province 
annual_gdp <- read.csv(
  file = "data/Annual_gdp.csv",
  header = TRUE,
  stringsAsFactors = FALSE,
  skip = 3
  )

annual_gdp <- head(annual_gdp,-1)


panel_gdp <- annual_gdp |>
  pivot_longer(
    cols = -Region,
    names_to =   "Year",
    values_to = "GDP"
  )


panel_all <- 
  right_join(
    panel_gdp,
    panel_residents,
    by= c("Region","Year")
  )
 
panel_all <- 
   mutate(
     panel_all,
     "GDP_per_capita" = GDP/Residents
     )

panel_all <- panel_all |>
  group_by(Region) |>
  arrange(Year, .by_group = TRUE)|>
  mutate (
    GDP_growth_rate = (GDP - lag(GDP))/lag(GDP),
    GDP_per_capita_growth_rate = (GDP_per_capita - lag(GDP_per_capita))/lag(GDP_per_capita)
  )

 panel_all <-  clean_year(panel_all)
```

**Downloading Dataset 3**

```{r}

# This  data is the ratio of the added value of the tertiary
  #    industry to the added value of the secondary industry
   #   to measure the deep transformation of industrial structure.
second_industry_increase <- read_csv(
  "data/second_industry_increase.csv",
   locale = locale(encoding = "GB18030"),
  skip=3 )

second_industry_increase <- 
  second_industry_increase|>
 rename(
    Region = `地区` 
  )

names(second_industry_increase)



panel_second_industry_increase <- 
  second_industry_increase|>
  pivot_longer(
    cols = -Region,
    names_to = "Year",
    values_to = "secondary_industry_increase"
  )

tertiary_industry_increase <- read_csv(
  "data/tertiary_industry_increase.csv",
   locale = locale(encoding = "GB18030"),
  skip=3 )

tertiary_industry_increase <- 
  tertiary_industry_increase|>
 rename(
    Region = `地区` 
  )

panel_tertiary_industry_increase <- 
  tertiary_industry_increase|>
  pivot_longer(
    cols = -Region,
    names_to = "Year",
    values_to = "tertiary_industry_increase"
  )

panel_industry_increase <- 
  right_join(
    panel_second_industry_increase,
    panel_tertiary_industry_increase,
    by=c("Region","Year")
    ) |> mutate(
      ratio =secondary_industry_increase/tertiary_industry_increase
    )



province_lookup <- tribble(
  ~Province,             ~Province_EN,
  "北京市",               "Beijing",
  "天津市",               "Tianjin",
  "上海市",               "Shanghai",
  "重庆市",               "Chongqing",
  "河北省",               "Hebei",
  "山西省",               "Shanxi",
  "辽宁省",               "Liaoning",
  "吉林省",               "Jilin",
  "黑龙江省",             "Heilongjiang",
  "江苏省",               "Jiangsu",
  "浙江省",               "Zhejiang",
  "安徽省",               "Anhui",
  "福建省",               "Fujian",
  "江西省",               "Jiangxi",
  "山东省",               "Shandong",
  "河南省",               "Henan",
  "湖北省",               "Hubei",
  "湖南省",               "Hunan",
  "广东省",               "Guangdong",
  "海南省",               "Hainan",
  "四川省",               "Sichuan",
  "贵州省",               "Guizhou",
  "云南省",               "Yunnan",
  "陕西省",               "Shaanxi",
  "甘肃省",               "Gansu",
  "青海省",               "Qinghai",
  "台湾省",               "Taiwan",
  "内蒙古自治区",         "Inner Mongolia",
  "广西壮族自治区",       "Guangxi",
  "西藏自治区",           "Tibet",
  "宁夏回族自治区",       "Ningxia",
  "新疆维吾尔自治区",     "Xinjiang"
)





panel_industry_increase <- panel_industry_increase %>%
  left_join(province_lookup,
            by = c("Region" = "Province")) 

panel_industry_increase <- panel_industry_increase %>%
  select(-1) %>%                
  select(last_col(), everything())

panel_industry_increase <- 
  clean_year(panel_industry_increase)
  

```

**Downloading Dataset 4**

```{r}
# The data set is about the growth rate of fixed asset.
#url = "https://data.stats.gov.cn/easyquery.htm?cn=E0103"
# This data is about the growth rate of fixed asset. But unfortunately, the data dates from 2018 and is not comprehensive.

Growth_rate_of_fixed_asset <- 
               read_csv("data/Growth_rate_of_fixed_asset(2018-2023).csv",
               locale = locale(encoding = "GB18030"),
               skip = 3)



Growth_rate_of_fixed_asset  <- head(Growth_rate_of_fixed_asset,-1) 


Growth_rate_of_fixed_asset <- Growth_rate_of_fixed_asset %>%
  select(where(~ !any(is.na(.))))

Growth_rate_of_fixed_asset <- Growth_rate_of_fixed_asset|>
  rename(
    Region = `地区`)

Growth_rate_of_fixed_asset <- Growth_rate_of_fixed_asset %>%
  left_join(province_lookup,
            by = c("Region" = "Province")) |>
  select(-1) %>%                
  select(last_col(), everything()) 

panel_growth_rate_of_fixed_asset <- 
  Growth_rate_of_fixed_asset|>
  pivot_longer(
    cols = -Province_EN,
    names_to = "Year",
    values_to = "growth_rate_of_fixed_asset"
  ) 
  panel_growth_rate_of_fixed_asset <- clean_year(panel_growth_rate_of_fixed_asset)

```

**Downloading Dataset 5**
```{r}
# This data is about the urbanization rate in China.
url = "https://www.stats.gov.cn/sj/ndsj/2021/indexch.htm"

# this data is extracted from the China Satistical yearbook and it is downloaded manually.

df1 <- 
  read_csv(
    "data/urbanization_rate(2005-2012).csv",
    skip =2
    )

df2 <- 
  read_csv(
    "data/urbanization_rate(2013-2023).csv"
    )

urbanization_rate <- 
  df1 |>
  right_join(df2, by="Region")|>
  slice(-1)

panel_urbanization_rate <- 
  urbanization_rate|>
  pivot_longer(
    cols = -"Region",
    names_to = "Year",
    values_to = "urbanization_rate")
```

**Downloading Dataset 6**
```{r}

#url = "http://www.moe.gov.cn/srcsite/A05/s3040/202412/t20241219_1167656.html" 
  #    "http://en.moe.gov.cn/"

Education_investment <- read_excel("data/education_investment(2001-2023).xlsx")





Education_investment<-
  Education_investment |>
  slice(-1)|>
  rename(
    Region = `...1` 
  )




panel_education_investment <- 
  Education_investment|>
  mutate(
    across(
      .cols = -Region,        
      .fns  = ~ as.numeric(.),
      .names = "{.col}")        
  ) |>
  pivot_longer(
    cols      = -Region,
    names_to  = "Year",
    values_to = "Education_investment"
  )

panel_education_investment <- panel_education_investment %>%
  left_join(province_lookup,
            by = c("Region" = "Province")) 

panel_education_investment<- panel_education_investment %>%
  select(-1) %>%                
  select(last_col(), everything()) 


```

**Downloading Dataset 7**
```{r}
#This data is about the degree of openness.It is the import and export volume of every province.

openness <-
  read_excel("data/import_and_export_volume(1996-2023).xlsx") |>
   select(-...3) |> 
   select(-...4) |>
   rename(
    Province_EN = `省份`, 
    Year = `年份`,
    Volume =`进出口总额（亿元）`
  )



```

**Downloading Dataset8**
```{r}
# this data is about the geographic information of each province in China, 
# url = https://gadm.org/download_country.html
# choose country =China， level=1. 
```

**Downloading Dataset 9**

```{r}
#it is a html file and i have edited it manually.
province_location <-
  read.csv(
    "data/province_location.csv"
    )
province_location$zone<-
  trimws(province_location$zone)

panel_all <- 
  panel_all |>
  right_join(
    province_location,
    by = "Region"
    )

```

<!-- ---------------------------------------------------------------------- -->

<!-- Blog post -->

<!-- ---------------------------------------------------------------------- -->

##Blog post

### Why we take the data
In order to study whether the development of Chinese provinces is regional 
equilibrium or Matthew effect, we believe that it is crucial to capture the 
relationship between the GDP of each province and its GDP growth rate. 
However, after reading some literature, we found that there are many control 
variables that can affect the GDP growth rate, such as the growth rate of fixed
asset investment, urbanization level, education investment level, and degree 
of opening up to the outside world. So we collected these data from the entire
Internet to exclude their possible influence on our conclusions.

### Data source for it

1. Dataset 1,2,3,4,5,7,9 are all from the Chinese National Bureau of Statistics
2.  Dataset 6 are from the Ministry of Education
3.  some explanations about the varibales 


### what the data tells us?

####Data processing
```{r}


panel_all <- panel_all %>% mutate(Year = as.character(Year))
panel_industry_increase <- panel_industry_increase %>% mutate(Year = as.character(Year))
panel_growth_rate_of_fixed_asset <- panel_growth_rate_of_fixed_asset|> mutate(Year =as.character(Year))
panel_urbanization_rate <- panel_urbanization_rate |> mutate(Year = as.character(Year))
panel_education_investment <- panel_education_investment|>mutate(Year=as.character(Year))
openness <- openness|>mutate(Year =as.character(Year))



panel_all <- 
  left_join(
    panel_all,
    panel_industry_increase,
    by=c("Region" = "Province_EN",
      "Year" )
    )


panel_all <- 
  left_join(
    panel_all,
    panel_growth_rate_of_fixed_asset,
    by =c("Region"= "Province_EN",
          "Year")
  )





panel_all <- 
  left_join(
    panel_all,
    panel_urbanization_rate,
    by =c("Region",
          "Year")
  )

panel_all <- 
  left_join(
    panel_all,
    panel_education_investment,
    by =c("Region"= "Province_EN",
          "Year")
  )

panel_all <- 
  left_join(
    panel_all,
    openness,
    by =c("Region"="Province_EN",
          "Year")
  )

panel_all <- 
  panel_all|>
  mutate(Year =as.integer(Year))|>
  arrange(Region,Year) |>
  group_by(Region)|>
  mutate(
    GDP_lag =lag(GDP),
    log_GDP_lag =log(GDP_lag),
    log_GDP = log(GDP)
  ) |>
  ungroup() |>
  filter(!is.na(GDP_lag))

panel_all <- panel_all|>
  mutate(
    Edu_share = Education_investment/GDP,
    Trade_share = Volume/GDP
  )

```


####Descriptive statistics and collinearity tests

```{r}
panel_all|>
  select(GDP_growth_rate,GDP_per_capita_growth_rate,log_GDP_lag,ratio,urbanization_rate,Trade_share,Edu_share,growth_rate_of_fixed_asset)|>
  summary()


ols_base <- lm(GDP_per_capita_growth_rate ~ log_GDP_lag 
               + ratio + urbanization_rate + Trade_share + Edu_share + growth_rate_of_fixed_asset, 
               data = panel_all %>% filter(Year==2020))
vif(ols_base)

```

####Cross-Sectional (2020) Regression Example

```{r}
df20 <- panel_all %>% filter(Year == 2020)
# 1. Absolute β convergence
lm1 <- lm(GDP_per_capita_growth_rate ~ log_GDP_lag, data = df20)
summary(lm1)

# 2. Conditional β convergence
lm2 <- lm(GDP_per_capita_growth_rate  ~ log_GDP_lag+
                    ratio+
                    urbanization_rate+
                    Trade_share+ 
                    Edu_share+ 
                    growth_rate_of_fixed_asset,
          data = df20)
summary(lm2)

tidy(lm2) %>%
  filter(term != "(Intercept)") %>%
  ggplot(aes(x = estimate, y = term)) +
    geom_point() +
    geom_errorbarh(aes(xmin=estimate-1.96*std.error,
                       xmax=estimate+1.96*std.error),
                   height=0.2) +
    labs(title="Conditional beta convergence regression coefficients for 2020",
         x="Coefficient estimates", y="variable") +
    theme_minimal()

```



####Panel fixed effects regression
```{r}
pdata <- pdata.frame(panel_all, index = c("Region","Year"))

fe_mod <- plm(GDP_per_capita_growth_rate ~ log_GDP_lag+
                    ratio+
                    urbanization_rate+
                    Trade_share+ 
                    Edu_share+ 
                    growth_rate_of_fixed_asset,
              data   = pdata,
              model  = "within",
              effect = "twoways")
summary(fe_mod)

tidy(fe_mod, conf.int = TRUE) %>%
  filter(term != "Intercept")


```

####Robustness test

```{r}

#here a Robustness test is required. 
```
####σ convergence

```{r}

sigma_df <- panel_all %>%
  group_by(Year) %>%
  summarize(sd_logGDP = sd(log_GDP, na.rm=TRUE))

ggplot(sigma_df, aes(x=Year,y=sd_logGDP)) +
  geom_line(size=1) +
  labs(title="The standard deviation of the logarithmic GDP of each province changes with the year",
       x="Year", y="sd") +
  theme_minimal()

```

####Visuaization

```{r}

# 1. We extract a year's data, like 2020.
df2020 <- panel_all %>%
  arrange(Region, Year) %>%      
  group_by(Region) %>%          
  mutate(gdp_lag = lag(GDP)) %>%   
  ungroup()

# 2. Draw a plot
p1 <- ggplot(df2020, aes(x = log(gdp_lag), y = GDP_per_capita_growth_rate, color = zone)) +
  geom_point(size = 3, alpha = 0.8) +
  stat_smooth(method = "lm", se = FALSE, linetype = "dashed") + 
  # Add a linear regression line
  stat_poly_eq(
    aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
    formula = y ~ x, parse = TRUE, size = 3
  ) +
  scale_color_brewer(type = "qual", palette = "Set1") +
  labs(
    title = "in 2020 the last year's GDP vs GDP growth rate for the year",
    x = "Logarithm of GDP in the previous year",
    y = "Year-on-year GDP_per_capita growth rate (%)",
    color = "zone"
  ) +
  theme_minimal(base_size = 14)

print(p1)

```

```{r}
library(tidyr)
library(ggplot2)

# 1. calculate the average number of the whole country
national_avg <- panel_all %>%
  group_by(Year) %>%
  summarize(
    gdp_avg = mean(GDP, na.rm = TRUE),
    gdp_pc_avg = mean(GDP_per_capita, na.rm = TRUE)
  )

# 2. extract some typical provinces to make a sample

provs <- c("Guangdong", "Beijing", "Guizhou", "Liaoning")
df_sub <- panel_all %>% filter(Region %in% provs)

# 3. Combine provincial data and national average into the same long format
df_plot <- bind_rows(
  df_sub %>% select(Region, Year, value = GDP_per_capita) %>% mutate(type = Region),
  national_avg %>% select(Year, value = gdp_pc_avg) %>% mutate(province = "National", type = "National")
)

# 4. draw plots
p2 <- ggplot(df_plot, aes(x = Year, y = value, color = type)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Time series comparison of GDP of typical provinces",
    x = "Year",
    y = "GDP_per_capita(10 thousand Yuan)",
    color = ""
  ) +
  scale_color_manual(values = c("National" = "black", "Guangdong" = "#1b9e77",
                                "Beijing" = "#d95f02", "Guizhou" = "#7570b3", "Liaoning" = "#e7298a")) +
  theme_minimal(base_size = 14)  +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )


print(p2)


```

```{r}
library(ineq)  


sigma_df <- panel_all %>%
  group_by(Year) %>%
  summarize(
    sd_log_gdp = sd(log(GDP), na.rm = TRUE),
    cv_gdp = sd(GDP, na.rm = TRUE) / mean(GDP, na.rm = TRUE),
    theil_gdp = Theil(GDP)
  ) %>%
  pivot_longer(-Year, names_to = "metric", values_to = "value")

sigma_df <- sigma_df %>%
  mutate(Year = as.numeric(as.character(Year)))

p3 <- ggplot(sigma_df, aes(x = Year, y = value)) +
  geom_line(size = 1) +
  facet_wrap(~ metric, scales = "free_y", ncol = 1, strip.position = "right") +
  labs(
    title = "Provincial GDP dispersion index changes by year",
    x = "Year",
    y = "Index value"
  ) +
  theme_minimal(base_size = 14)

print(p3)

```

```{r render-gif, cache=TRUE, echo=FALSE, message= FALSE, warning=FALSE}

# 1. Read and project provincial boundaries
china_sf <- st_read("data/gadm41_CHN_shp/gadm41_CHN_1.shp") %>%
  st_transform(4326)
names(china_sf)

panel_for_map <- panel_all|> select(Region,GDP,Year,GDP_per_capita_growth_rate)

panel_for_map <- 
  panel_for_map |>
  mutate(Region = recode(Region,
                        "Xinjiang"="Xinjiang Uygur" ,
                        "Tibet" = "Xizang" ,
                       "Inner Mongolia"=  "Nei Mongol"))

# 2. Combine panel data and spatial data to obtain the geometry and indicators of each province each year
map_data <- panel_for_map %>%
  
  mutate(Year = as.integer(Year)) %>%
  
  left_join(china_sf, by = c("Region" = "NAME_1")) %>%
  st_as_sf()

# 3. Build a ggplot object (without animation)
p <- ggplot(map_data) +
  geom_sf(aes(fill = GDP_per_capita_growth_rate), color = "grey90", size = 0.2) +
  scale_fill_viridis_c(
    option   = "plasma",
    direction= -1,
    na.value = "white",
    name      = "increase_rate (%)"
  ) +
  labs(
    title = 'China provincial GDP growth: {frame_time}',
    subtitle = "Year：{frame_time}",
    x = NULL, y = NULL
  ) +
  theme_void(base_size = 14) +
  theme(
    plot.title    = element_text(hjust = 0.5, size = 18),
    plot.subtitle = element_text(hjust = 0.5, size = 14)
  )

# 4. Add animation effect: continuous transition by Year
p_anim <- p +
  transition_time(Year) +
  ease_aes('linear')

gif_path <- "china_gdp_per_capita_growth.gif"

# 5. Render and save (GIF or MP4)
if(!file.exists(gif_path)){
anim <- animate(
  p_anim,
  nframes = length(unique(map_data$Year)) * 2,  
  fps     = 5,                                  
  width   = 800,
  height  = 600,
  renderer = gifski_renderer()                  
)

anim_save("china_gdp_per_capita_growth.gif", animation = anim)
}else{message("Using cached GIF:",gif_path)}




```


### So what

### what's really under the surface?
The conclusion is that, from the perspective of GDP_per_capita, China
is going to convergence.
Explanation:


###References

R-packages



Data



Method and inspiration

Jin, S. (2025). Industrial Upgrading and New Quality Productive Forces: Evidence from China's Provincial Panel Data (2003–2022) [Preprint]. arXiv. https://arxiv.org/abs/2501.14258




<!-- ---------------------------------------------------------------------- -->

<!-- Behind the Scenes - Task 3 Tab -->

<!-- ---------------------------------------------------------------------- -->

## Behind the Scene

### What's in the section

#### Question 4

*Tell us about a part(s) of your data processing or analysis that
weren't "sexy" and wouldn't typically be included in a blog post. (e.g.
Was their any data drudgery or time intensive wrangling? Were there any
repetitive tasks or manual tasks? If it was easy, describe what made it
easy?)*



#### Question 5

*Were there any challenges that you faced in conducting this analysis.
These may take the form of data limitations or coding challenges? (e.g.
Was there anything in your analysis that you were not anticipating when
you started? Did you have to change your intended scope?)*

When we first analyzed the Matthew effect or regional equilibrium, we used GDP and GDP growth rate. We believed that when the GDP growth rate was positively correlated with the total GDP, we could draw the conclusion of the Matthew effect. But later we found through empirical analysis that there is no such pattern. This is because China's various provincial administrative regions were not evenly divided at the beginning. On the contrary, the two most developed cities in China, Beijing and Shanghai, have provincial administrative levels, but their administrative scope is very small, which leads to their economic totals not being at the forefront nationwide. If the Matthew effect is significant, these two cities must have the highest economic growth, but the data shows that the two regions ranked ninth (Shanghai) and eleventh (Beijing) have the highest economic growth. This obviously does not conform to our empirical analysis. So later we chose to use per capita GDP and its growth as indicators.

Later, in the process of empirical analysis, we found that some provinces, such as Tibet, whose administrative regions are mostly located in the Qinghai-Tibet Plateau, have sparse economic activities. Its GDP in 2024 is 296.4 billion, which is only about 2% of the first place, Guangdong Province's 14163.3 billion. This led to extreme values in our analysis. Later, we found that a common practice is to take the logarithm of GDP and then conduct empirical analysis with other variables.

At the beginning, we used the government's annual investment in education as an indicator of education investment, and the sum of each region's commodity imports and exports to measure a region's degree of openness. Later we found three problems. First, the multicollinearity analysis failed, because the government's investment in education is often regarded as part of government investment. It and exports can be included in GDP at the same time, increasing and decreasing together. Second, when analyzing the data, we found that wealthy provinces naturally performed better in education and import and export volumes, while poor provinces invested less in education and had less import and export trade. This cannot measure the degree of importance a region places on education and the degree of openness to the outside world, which is contrary to the original intention of our setting up this control variable. So later we used the proportion of education investment in GDP as an indicator of education investment, and the proportion of imports and exports in GDP as an indicator of openness to the outside world.

#### Question 6

*Tell us about any imperfect parts of your work or how would like to
expand this analysis in future? (We don't expect you to solve everything
in one assignment.)*

#### Question 7

*An additional 2 marks will be awarded for the code you used to produce
your analysis and report. These marks include reproducibility, compiling
of your .html, production of any figures and tables etc.*
